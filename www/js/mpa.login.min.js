// 2017-01-07 V 1.0.0
//  - First version

$( document ).ready( function()
{
	$( "#tryLogin" ).click( validate );
	$( "#login, #password" ).keypress(function( event )
	{
		if( event.which == 13 )
		{
			event.preventDefault();
			validate();
		}
	});
});

function validate()
{
	var loginButton = $( this );
	
	// Disable button
	loginButton.prop( "disabled" , true );
	
	$.post('/mpa/res/users/login', {
		login : $( "#login" ).val(),
		pwd   : $( "#password" ).val()
	}).done(function(data)
	{
		var response = jQuery.parseJSON(data);
		var token = response.id;

		// Error in token value
		if( isNaN(parseInt(token, 16)) )
		{
			// Display error message
			alert(token);
			
			// Enable button after server response
			loginButton.prop( "disabled" , false );
		}
		else
		{
			// Redirect to accounts page
			window.location.href = "../mpa/accounts/?token=" + token;
		}
	}).fail(function() {
		alert("Error, asks administrator for details");
	}).always(function() {
		// Enable button after server response
		loginButton.prop( "disabled" , false );
	});
};
